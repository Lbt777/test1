<!--
 * @Author: lbt666 '1319451895@qq.com'
 * @Date: 2022-11-14 14:11:05
 * @LastEditors: lbt666 '1319451895@qq.com'
 * @LastEditTime: 2022-11-14 14:13:58
 * @Description: 
-->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <title>联系信息</title>
  <meta charset="utf-8" />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta name="viewport" content="width=device-width, user-scalable=no" />
  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="css/LArea.css" />
</head>

<body>
  <div class="header">
    <button onclick="window.history.back()">
      <img src="images/back.png" />
    </button>
    <span>联系信息</span>
    <div></div>
  </div>
  <div class="inputs">
    <input type="text" placeholder="请输入联系人姓名" />
    <input type="tel" placeholder="请输入联系人手机号" maxlength="11" />
    <input type="text" placeholder="邮箱地址" />
    <input type="text" id="pcd" readonly placeholder="请选择省市区" />
    <input type="text" placeholder="请输入合同邮寄地址" />
    <button class="btn" onclick="next()">保存</button>
    <div><span>*合同邮寄地址，请务必核对真实</span></div>
  </div>
</body>
<script src="dist/js/LAreaData.js"></script>
<script src="dist/js/LArea.js"></script>
<script src="dist/js/main.js"></script>
<script>
  const user = JSON.parse(window.localStorage.getItem("user")).data;
  var inputs = document.getElementsByTagName("input");
  inputs[0].defaultValue = user.addressname || user.name;
  inputs[1].defaultValue = user.addressphone || user.phone;
  inputs[2].defaultValue = user.email || "";
  inputs[3].defaultValue =
    (user.province ? user.province + "," : "") +
    (user.city ? user.city + "," : "") +
    user.area;
  inputs[4].defaultValue = user.address;
  function next () {
    var name = inputs[0].value;
    var phone = inputs[1].value;
    var email = inputs[2].value;
    var pcd = inputs[3].value.split(",");
    if (pcd.length === 3) {
      pcd = {
        province: pcd[0],
        city: pcd[1],
        area: pcd[2],
      };
    } else if (pcd.length === 2) {
      pcd = {
        city: pcd[0],
        area: pcd[1],
      };
    }
    var address = inputs[4].value;
    saveContact({ name, phone, email, address, ...pcd }, () => {
      user.addressname = name;
      user.addressphone = phone;
      user.address = address;
      user.email = email;
      user.province = pcd.province;
      user.city = pcd.city;
      user.area = pcd.area;
      window.localStorage.setItem("user", JSON.stringify(user));
      window.history.back();
    });
  }
  var area1 = new LArea();
  area1.init({
    trigger: "#pcd", //触发选择控件的文本框，同时选择完毕后name属性输出到该位置
    keys: {
      id: "id",
      name: "name",
    }, //绑定数据源相关字段 id对应valueTo的value属性输出 name对应trigger的value属性输出
    type: 1, //数据源类型
    data: LAreaData, //数据源
  });
</script>

</html>